/**
 * @name jQuery PointAt
 * @version 1.2
 * @author Klaus Karkia
 * @license MIT license
 * 
 * Last update: 18.2.2013
 * 
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 * Website: http://pointat.idenations.com
 * Contact: pointat@idenations.com
 *
 * Requires jqrotate, http://plugins.jquery.com/jqrotate/
 * or a similar plugin that allows element rotation
 * 
 */
(function(c){var b,d,a={init:function(e){d={hookScroll:true,hookDrag:true,draggable:null,pointAtInit:true,defaultDirection:"up",angleLessThanFunc:null,angleGreaterThanFunc:null,getAngleFrom:null,passAngleTo:null,xCorrection:0,yCorrection:0,pause:false,rotateFunction:"jqrotate",changeTargetTo:"low"};b=c.extend({},d,e);return this.each(function(){var g=c("body").data("pointatcount"),f=c(this).data("myid.pointat"),i=".pointat",h=this;f=+f||0;i=".pointat"+f;if(f>0){oldsettings=c(this).data("settings.pointat");c.each(b,function(j,k){if(k===d[j]){b[j]=oldsettings[j];}});c(this).data("settings.pointat",b);}else{g=+g||0;g++;i=".pointat"+g;c(this).data("settings.pointat",b);c(this).data("myid.pointat",g);c("body").data("pointatcount",g);}if(b.hookScroll){scrollnspace="scroll"+i;c(window).bind(scrollnspace,function(){a.updateRotation.apply(h);});}if(b.hookDrag){if(b.draggable!==null){c(b.draggable).bind("drag.pointat",function(){a.updateRotation.apply(h);});}else{c(h).bind("drag.pointat",function(){a.updateRotation.apply(h);});}}if(b.pointAtInit){a.updateRotation.apply(this);}});},getAngle:function(h){var g=c(this).data("settings.pointat"),e,f,i;if(!g){c.error("Method getAngle used on an element that does not have jQuery.PointAt initialized.");}h=typeof h!=="undefined"?h:g.target;if(h instanceof Array){h=h[0];}f=c(h).offset();i=0;if(g.getAngleFrom!==null){e=c(g.getAngleFrom).offset();}else{e=c(this).offset();}i=Math.atan2(((f.left+g.xCorrection)-e.left),((f.top+g.yCorrection)-e.top))*180/Math.PI;i=180-Math.ceil(i);if(g.defaultDirection==="right"){i=i-90;}else{if(g.defaultDirection==="down"){i=i-180;}else{if(g.defaultDirection==="left"){i=i-270;}else{if(g.defaultDirection==="up"){}else{i=i-parseInt(g.defaultDirection,10);}}}}if(i<0){i=360+i;}else{if(i>360){i=0+i;}}return i;},updateRotation:function(){return c(this).each(function(){var g=c(this).data("settings.pointat"),f=c(this).data("angle.pointat"),l=[],h,e,n,j,k=g.changeTargetTo,m=370;if(!g){c.error("Method updateRotation used on an element that does not have jQuery.PointAt initialized.");}if(g.target instanceof Array){if(isNaN(f)){if(g.changeTargetTo==="low"){f=361;}else{if(g.changeTargetTo==="high"){f=-1;}else{f=-1;}}}if(g.changeTargetTo==="low"){k=0;}else{if(g.changeTargetTo==="high"){k=360;}}for(j=0;j<g.target.length;j++){h=a.getAngle.apply(this,[g.target[j]]);if(m>Math.abs(k-h)){m=Math.abs(k-h);f=h;n=g.target[j];}}e=c(this).data("currentTarget.pointat");if(n!==e){l=[n,e];c(this).data("currentTarget.pointat",n);c(this).trigger("changedTarget",l);}}else{f=a.getAngle.apply(this);}if(g.pause===false){l=[c(this).data("angle.pointat"),f];c(this).trigger("beforeRotate",l);}if(g.angleLessThanFunc!==null){if(f<g.angleLessThan){g.angleLessThanFunc.apply(this);}}if(g.angleGreaterThanFunc!==null){if(f>g.angleGreaterThan){g.angleGreaterThanFunc.apply(this);}}if(g.passAngleTo!==null){if(c(g.passAngleTo).is("input")){c(g.passAngleTo).val(f);}else{c(g.passAngleTo).html(f);}}if(g.pause===false){c(this).data("angle.pointat",f);c(this)[g.rotateFunction](f);}c(this).trigger("afterRotate",l);});},destroy:function(){return this.each(function(){var f=c(this).data("settings.pointat"),e,g;if(!f){c.error("Method destroy used on an element that does not have jQuery.PointAt initialized.");}e=c(this).data("myid.pointat");g=".pointat";e=+e||0;g=".pointat"+e;c(window).unbind(g);if(f.hookDrag){if(f.draggable!==null){c(f.draggable).unbind("drag.pointat");}else{c(this).unbind("drag.pointat");}}c(this).removeData("settings.pointat");c(this).removeData("myid.pointat");});},pause:function(){return this.each(function(){var e=c(this).data("settings.pointat");if(e){e.pause=true;c(this).data("settings.pointat",e);}else{c.error("Method pause used on an element that does not have jQuery.PointAt initialized.");}});},resume:function(){return this.each(function(){var e=c(this).data("settings.pointat");if(e){e.pause=false;c(this).data("settings.pointat",e);}else{c.error("Method resume used on an element that does not have jQuery.PointAt initialized.");}});}};c.fn.pointat=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof e==="object"||!e){return a.init.apply(this,arguments);}else{c.error("Method "+e+" does not exist on jQuery.pointat");}}};})(jQuery);